<div class="max-w-4xl mx-auto flex flex-col min-h-[calc(100vh-6rem)]">
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6 shrink-0">
    <div class="flex flex-wrap items-center gap-3">
      <div class="flex items-center gap-2 shrink-0">
        <label for="words-sort" class="text-sm font-medium text-foreground whitespace-nowrap">Sort by</label>
        <z-select
          id="words-sort"
          [ngModel]="sortBy() + ':' + order()"
          (ngModelChange)="onSortChange($event)"
          zPlaceholder="Sort by"
          class="min-w-[13rem] [&_button_span]:flex-nowrap [&_button_span]:whitespace-nowrap"
        >
          @for (opt of sortOptions; track opt.label) {
            <z-select-item [zValue]="opt.sortBy + ':' + opt.order">{{ opt.label }}</z-select-item>
          }
        </z-select>
      </div>

      <div class="flex items-center gap-2 shrink-0">
        <input
          id="words-search"
          z-input
          type="text"
          [ngModel]="search()"
          (ngModelChange)="onSearchChange($event)"
          placeholder="Search by word"
          class="min-w-[12rem]"
        />

        @if (totalCount() !== null) {
          <p class="text-sm text-muted-foreground shrink-0">
            {{ totalCount() }} word{{ totalCount() === 1 ? '' : 's' }}
          </p>
        }
      </div>
    </div>

    <app-word-form-dialog
      [word]="editingWord()"
      (saved)="onWordSaved($event)"
      (dialogCancel)="onDialogCancel()"
    />
  </div>

  @if (error()) {
    <p class="text-red-600 mb-4 shrink-0">{{ error() }}</p>
  }

  @if (loading()) {
    <p class="text-muted-foreground shrink-0">Loading words...</p>
  } @else if (words().length === 0) {
    <p class="text-muted-foreground shrink-0">No words yet. Add one to get started.</p>
  } @else {
    <cdk-virtual-scroll-viewport
      itemSize="110"
      class="flex-1 min-h-0 w-full block relative z-0"
      (scrolledIndexChange)="onScrolledIndexChange()"
    >
      <app-word-list-item
        *cdkVirtualFor="let w of words(); trackBy: trackByWordId"
        [word]="w"
        (deleted)="onWordDeleted(w._id)"
        (editRequested)="editingWord.set($event)"
        class="block mb-2"
      />
      @if (loadingMore()) {
        <p class="mt-4 text-muted-foreground text-center">Loading more...</p>
      }
    </cdk-virtual-scroll-viewport>
  }
</div>
